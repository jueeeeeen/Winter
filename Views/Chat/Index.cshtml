<h2>Live Chat</h2>
<div id="messages"></div>
<input type="text" id="messageInput" placeholder="Enter your message" />
<button id="sendButton">Send</button>

<script>
    let socket;
    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    function initWebSocket() {
        const urlParams = new URLSearchParams(window.location.search);
        const activity_id = urlParams.get('activity_id');
        socket = new WebSocket(`ws://localhost:5115/chat/OnConnected?activity_id=${activity_id}`);
        
        socket.onmessage = function (event) {
            console.log("Message received: ", event.data);
            const message = event.data;
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);
        };

        socket.onopen = function () {
            console.log('WebSocket connection established');
        };

        socket.onclose = function () {
            console.log('WebSocket connection closed');
        };

        socket.onerror = function (error) {
            console.error('WebSocket Error:', error);
        };
    }

    // Send message when the Send button is clicked
    sendButton.addEventListener('click', function (event) {
    event.preventDefault();  // Prevent form submission or unwanted refresh
    const message = messageInput.value;
    if (message && socket.readyState === WebSocket.OPEN) {
        socket.send(message);
        messageInput.value = '';  // Clear input field
    }
    return false; // Ensure no default action happens
});


    // Initialize WebSocket connection on page load
    window.onload = initWebSocket;
</script>